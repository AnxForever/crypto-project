{% extends "base.html" %}

{% block title %}IBEåŠ å¯†å·¥å…· - å¯†ç å­¦å·¥å…·å¹³å°{% endblock %}

{% block extra_head %}
<style>
    .workflow-steps {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 20px;
        margin-bottom: 30px;
    }

    .step-card {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(20px);
        border-radius: 15px;
        padding: 20px;
        text-align: center;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.18);
        position: relative;
        transition: all 0.3s ease;
    }

    .step-card.completed {
        border: 2px solid #4caf50;
        background: rgba(76, 175, 80, 0.1);
    }

    .step-card.active {
        border: 2px solid #667eea;
        transform: translateY(-3px);
    }

    .step-number {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        color: white;
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: bold;
        margin: 0 auto 15px;
    }

    .step-card.completed .step-number {
        background: #4caf50;
    }

    .step-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
    }

    .step-description {
        font-size: 12px;
        color: #666;
    }

    .ibe-section {
        background: rgba(255, 255, 255, 0.9);
        backdrop-filter: blur(20px);
        border-radius: 20px;
        padding: 30px;
        margin-bottom: 30px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
        border: 1px solid rgba(255, 255, 255, 0.18);
    }

    .section-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 25px;
        padding-bottom: 15px;
        border-bottom: 2px solid #667eea;
    }

    .section-title {
        font-size: 20px;
        font-weight: bold;
        color: #333;
        display: flex;
        align-items: center;
    }

    .section-title i {
        margin-right: 10px;
        color: #667eea;
    }

    .status-indicator {
        padding: 5px 12px;
        border-radius: 15px;
        font-size: 12px;
        font-weight: bold;
    }

    .status-pending {
        background: rgba(255, 193, 7, 0.2);
        color: #f57c00;
    }

    .status-ready {
        background: rgba(76, 175, 80, 0.2);
        color: #2e7d32;
    }

    .identity-input {
        display: flex;
        gap: 10px;
        align-items: end;
        margin-bottom: 20px;
    }

    .identity-input .form-group {
        flex: 1;
        margin-bottom: 0;
    }

    .key-display-grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 20px;
        margin-top: 20px;
    }

    .key-item-ibe {
        background: #f8f9fa;
        border: 1px solid #e0e0e0;
        border-radius: 10px;
        padding: 15px;
        position: relative;
    }

    .key-label-ibe {
        font-weight: bold;
        color: #333;
        margin-bottom: 10px;
        display: block;
    }

    .key-content {
        font-family: 'Courier New', monospace;
        font-size: 12px;
        word-break: break-all;
        background: white;
        padding: 10px;
        border-radius: 5px;
        border: 1px solid #ddd;
        max-height: 150px;
        overflow-y: auto;
    }

    .message-exchange {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 30px;
        margin-top: 20px;
    }

    .message-panel {
        background: #f8f9fa;
        border-radius: 15px;
        padding: 20px;
        border: 1px solid #e0e0e0;
    }

    .panel-title {
        font-weight: bold;
        color: #333;
        margin-bottom: 15px;
        display: flex;
        align-items: center;
    }

    .panel-title i {
        margin-right: 8px;
        color: #667eea;
    }

    /* å¢å¼ºçš„ç®—æ³•é€‰æ‹©å™¨æ ·å¼ */
    .algorithm-intro {
        color: #666;
        font-size: 16px;
        line-height: 1.6;
        margin-bottom: 30px;
        text-align: center;
    }

    .ibe-algorithm-selector.enhanced {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
        gap: 25px;
        margin-bottom: 40px;
    }

    .algorithm-card-enhanced {
        background: linear-gradient(145deg, #ffffff 0%, #f8f9fa 100%);
        border: 2px solid rgba(102, 126, 234, 0.1);
        border-radius: 20px;
        padding: 25px;
        transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        cursor: pointer;
        position: relative;
        overflow: hidden;
        box-shadow: 0 10px 40px rgba(31, 38, 135, 0.1);
    }

    .algorithm-card-enhanced::before {
        content: '';
        position: absolute;
        top: 0;
        left: -100%;
        width: 100%;
        height: 100%;
        background: linear-gradient(90deg, transparent, rgba(102, 126, 234, 0.05), transparent);
        transition: left 0.6s ease;
    }

    .algorithm-card-enhanced:hover::before {
        left: 100%;
    }

    .algorithm-card-enhanced:hover {
        transform: translateY(-8px);
        box-shadow: 0 20px 60px rgba(31, 38, 135, 0.15);
        border-color: rgba(102, 126, 234, 0.3);
    }

    .algorithm-card-enhanced.active {
        border-color: #667eea;
        background: linear-gradient(145deg, #ffffff 0%, rgba(102, 126, 234, 0.02) 100%);
        transform: translateY(-5px);
        box-shadow: 0 15px 50px rgba(102, 126, 234, 0.2);
    }

    .algorithm-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
    }

    .algorithm-icon {
        width: 50px;
        height: 50px;
        border-radius: 15px;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 24px;
        box-shadow: 0 8px 25px rgba(102, 126, 234, 0.3);
    }

    .algorithm-badge {
        padding: 6px 12px;
        border-radius: 20px;
        font-size: 12px;
        font-weight: bold;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }

    .algorithm-badge.classic {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
        color: white;
    }

    .algorithm-badge.secure {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        color: white;
    }

    .algorithm-badge.performance {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        color: white;
    }

    .algorithm-content h3.algorithm-name {
        font-size: 24px;
        font-weight: bold;
        color: #333;
        margin-bottom: 5px;
    }

    .algorithm-subtitle {
        color: #666;
        font-size: 14px;
        margin-bottom: 20px;
    }

    .algorithm-features {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        margin-bottom: 20px;
    }

    .feature-item {
        display: flex;
        align-items: center;
        gap: 8px;
        background: rgba(102, 126, 234, 0.08);
        padding: 8px 12px;
        border-radius: 20px;
        font-size: 13px;
        color: #555;
    }

    .feature-item i {
        color: #667eea;
        font-size: 14px;
    }

    .algorithm-specs {
        margin-bottom: 20px;
    }

    .spec-item {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 8px 0;
        border-bottom: 1px solid rgba(102, 126, 234, 0.1);
    }

    .spec-item:last-child {
        border-bottom: none;
    }

    .spec-label {
        font-weight: 500;
        color: #555;
        font-size: 13px;
    }

    .spec-value {
        font-weight: bold;
        color: #333;
        font-size: 13px;
    }

    .performance-indicator {
        margin-bottom: 20px;
    }

    .perf-bar {
        display: flex;
        align-items: center;
        gap: 12px;
        margin-bottom: 12px;
    }

    .perf-label {
        font-size: 12px;
        font-weight: 500;
        color: #555;
        min-width: 40px;
    }

    .perf-progress {
        flex: 1;
        height: 8px;
        background: rgba(102, 126, 234, 0.1);
        border-radius: 4px;
        overflow: hidden;
    }

    .perf-fill {
        height: 100%;
        background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
        border-radius: 4px;
        transition: width 0.6s ease;
    }

    .perf-score {
        font-size: 12px;
        font-weight: bold;
        color: #667eea;
        min-width: 45px;
        text-align: right;
    }

    .algorithm-footer {
        text-align: center;
        padding-top: 15px;
        border-top: 1px solid rgba(102, 126, 234, 0.1);
    }

    .selection-hint {
        font-size: 13px;
        color: #667eea;
        font-weight: 500;
    }

    /* ç®—æ³•å¯¹æ¯”æ€»ç»“æ ·å¼ */
    .algorithm-comparison-summary {
        background: linear-gradient(145deg, #f8f9fa 0%, #ffffff 100%);
        border-radius: 20px;
        padding: 30px;
        margin-top: 30px;
        box-shadow: 0 8px 32px rgba(31, 38, 135, 0.08);
        border: 1px solid rgba(102, 126, 234, 0.1);
    }

    .algorithm-comparison-summary h3 {
        color: #333;
        font-size: 20px;
        margin-bottom: 25px;
        text-align: center;
    }

    .algorithm-comparison-summary h3 i {
        color: #667eea;
        margin-right: 10px;
    }

    .comparison-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 20px;
    }

    .comparison-item {
        display: flex;
        align-items: center;
        gap: 15px;
        padding: 20px;
        background: white;
        border-radius: 15px;
        box-shadow: 0 5px 20px rgba(31, 38, 135, 0.08);
        transition: all 0.3s ease;
        border: 1px solid rgba(102, 126, 234, 0.05);
    }

    .comparison-item:hover {
        transform: translateY(-3px);
        box-shadow: 0 10px 30px rgba(31, 38, 135, 0.12);
    }

    .comparison-icon {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-size: 20px;
        flex-shrink: 0;
    }

    .comparison-icon.academic {
        background: linear-gradient(135deg, #f39c12 0%, #e67e22 100%);
    }

    .comparison-icon.security {
        background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
    }

    .comparison-icon.performance {
        background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
    }

    .comparison-content h4 {
        font-size: 16px;
        font-weight: bold;
        color: #333;
        margin-bottom: 8px;
    }

    .comparison-content p {
        font-size: 14px;
        color: #666;
        line-height: 1.5;
        margin: 0;
    }

    @media (max-width: 768px) {
        .key-display-grid,
        .message-exchange {
            grid-template-columns: 1fr;
        }
        
        .workflow-steps {
            grid-template-columns: 1fr;
        }

        .ibe-algorithm-selector.enhanced {
            grid-template-columns: 1fr;
        }

        .comparison-grid {
            grid-template-columns: 1fr;
        }

        .algorithm-features {
            justify-content: center;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title"><i class="fas fa-user-shield"></i> IBEåŠ å¯†å·¥å…·</h1>
    <p class="page-description">
        åŸºäºèº«ä»½çš„åŠ å¯†ç³»ç»Ÿå·¥å…·ï¼Œæ”¯æŒBoneh-Franklinã€Boneh-Boyenå’ŒSakai-Kasaharaä¸‰ç§IBEæ–¹æ¡ˆã€‚
    </p>
</div>

<!-- ç®—æ³•é€‰æ‹©å™¨ -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-cogs"></i> é€‰æ‹©IBEç®—æ³•</h2>
    <p class="algorithm-intro">é€‰æ‹©æœ€é€‚åˆæ‚¨éœ€æ±‚çš„åŸºäºèº«ä»½åŠ å¯†ï¼ˆIBEï¼‰ç®—æ³•ã€‚æ¯ç§ç®—æ³•éƒ½æœ‰å…¶ç‹¬ç‰¹çš„ä¼˜åŠ¿å’Œé€‚ç”¨åœºæ™¯ã€‚</p>
    
    <div class="ibe-algorithm-selector enhanced">
        <!-- Boneh-Franklin ç®—æ³•å¡ç‰‡ -->
        <div class="algorithm-card-enhanced active" data-algorithm="boneh_franklin">
            <div class="algorithm-header">
                <div class="algorithm-icon">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="algorithm-badge classic">ç»å…¸</div>
            </div>
            <div class="algorithm-content">
                <h3 class="algorithm-name">Boneh-Franklin</h3>
                <p class="algorithm-subtitle">ç»å…¸IBEæ–¹æ¡ˆ</p>
                <div class="algorithm-features">
                    <div class="feature-item">
                        <i class="fas fa-book"></i>
                        <span>ç†è®ºå®Œå–„</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-shield-alt"></i>
                        <span>å®‰å…¨æ€§å¼º</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-university"></i>
                        <span>å­¦æœ¯æ ‡å‡†</span>
                    </div>
                </div>
                <div class="algorithm-specs">
                    <div class="spec-item">
                        <span class="spec-label">å®‰å…¨æ¨¡å‹:</span>
                        <span class="spec-value">éšæœºé¢„è¨€æœº</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">æ¤­åœ†æ›²çº¿:</span>
                        <span class="spec-value">åŒçº¿æ€§é…å¯¹</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">é€‚ç”¨åœºæ™¯:</span>
                        <span class="spec-value">æ•™å­¦ç ”ç©¶</span>
                    </div>
                </div>
                <div class="performance-indicator">
                    <div class="perf-bar">
                        <span class="perf-label">æ€§èƒ½</span>
                        <div class="perf-progress">
                            <div class="perf-fill" style="width: 70%"></div>
                        </div>
                        <span class="perf-score">7/10</span>
                    </div>
                    <div class="perf-bar">
                        <span class="perf-label">å®‰å…¨</span>
                        <div class="perf-progress">
                            <div class="perf-fill" style="width: 90%"></div>
                        </div>
                        <span class="perf-score">9/10</span>
                    </div>
                </div>
            </div>
            <div class="algorithm-footer">
                <span class="selection-hint">ğŸ“š ç†æƒ³çš„å­¦ä¹ ç ”ç©¶é€‰æ‹©</span>
            </div>
        </div>

        <!-- Boneh-Boyen ç®—æ³•å¡ç‰‡ -->
        <div class="algorithm-card-enhanced" data-algorithm="boneh_boyen">
            <div class="algorithm-header">
                <div class="algorithm-icon">
                    <i class="fas fa-key"></i>
                </div>
                <div class="algorithm-badge secure">å®‰å…¨</div>
            </div>
            <div class="algorithm-content">
                <h3 class="algorithm-name">Boneh-Boyen</h3>
                <p class="algorithm-subtitle">æ ‡å‡†æ¨¡å‹IBE</p>
                <div class="algorithm-features">
                    <div class="feature-item">
                        <i class="fas fa-lock"></i>
                        <span>æ ‡å‡†æ¨¡å‹</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-certificate"></i>
                        <span>å¯è¯æ˜å®‰å…¨</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-balance-scale"></i>
                        <span>åŒé‡ä¿æŠ¤</span>
                    </div>
                </div>
                <div class="algorithm-specs">
                    <div class="spec-item">
                        <span class="spec-label">å®‰å…¨æ¨¡å‹:</span>
                        <span class="spec-value">æ ‡å‡†æ¨¡å‹</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">å¯†é’¥ç±»å‹:</span>
                        <span class="spec-value">åŒä¸»å¯†é’¥</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">é€‚ç”¨åœºæ™¯:</span>
                        <span class="spec-value">é«˜å®‰å…¨éœ€æ±‚</span>
                    </div>
                </div>
                <div class="performance-indicator">
                    <div class="perf-bar">
                        <span class="perf-label">æ€§èƒ½</span>
                        <div class="perf-progress">
                            <div class="perf-fill" style="width: 75%"></div>
                        </div>
                        <span class="perf-score">7.5/10</span>
                    </div>
                    <div class="perf-bar">
                        <span class="perf-label">å®‰å…¨</span>
                        <div class="perf-progress">
                            <div class="perf-fill" style="width: 95%"></div>
                        </div>
                        <span class="perf-score">9.5/10</span>
                    </div>
                </div>
            </div>
            <div class="algorithm-footer">
                <span class="selection-hint">ğŸ›¡ï¸ æœ€é«˜å®‰å…¨ç­‰çº§ä¿éšœ</span>
            </div>
        </div>

        <!-- Sakai-Kasahara ç®—æ³•å¡ç‰‡ -->
        <div class="algorithm-card-enhanced" data-algorithm="sakai_kasahara">
            <div class="algorithm-header">
                <div class="algorithm-icon">
                    <i class="fas fa-rocket"></i>
                </div>
                <div class="algorithm-badge performance">é«˜æ•ˆ</div>
            </div>
            <div class="algorithm-content">
                <h3 class="algorithm-name">Sakai-Kasahara</h3>
                <p class="algorithm-subtitle">é«˜æ•ˆIBEæ–¹æ¡ˆ</p>
                <div class="algorithm-features">
                    <div class="feature-item">
                        <i class="fas fa-tachometer-alt"></i>
                        <span>æé€Ÿå¤„ç†</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-server"></i>
                        <span>ç”Ÿäº§å°±ç»ª</span>
                    </div>
                    <div class="feature-item">
                        <i class="fas fa-chart-line"></i>
                        <span>æ€§èƒ½ä¼˜åŒ–</span>
                    </div>
                </div>
                <div class="algorithm-specs">
                    <div class="spec-item">
                        <span class="spec-label">å®‰å…¨æ¨¡å‹:</span>
                        <span class="spec-value">éšæœºé¢„è¨€æœº</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">ç‰¹è‰²ä¼˜åŠ¿:</span>
                        <span class="spec-value">é«˜æ•ˆè¿ç®—</span>
                    </div>
                    <div class="spec-item">
                        <span class="spec-label">é€‚ç”¨åœºæ™¯:</span>
                        <span class="spec-value">ç”Ÿäº§ç¯å¢ƒ</span>
                    </div>
                </div>
                <div class="performance-indicator">
                    <div class="perf-bar">
                        <span class="perf-label">æ€§èƒ½</span>
                        <div class="perf-progress">
                            <div class="perf-fill" style="width: 95%"></div>
                        </div>
                        <span class="perf-score">9.5/10</span>
                    </div>
                    <div class="perf-bar">
                        <span class="perf-label">å®‰å…¨</span>
                        <div class="perf-progress">
                            <div class="perf-fill" style="width: 85%"></div>
                        </div>
                        <span class="perf-score">8.5/10</span>
                    </div>
                </div>
            </div>
            <div class="algorithm-footer">
                <span class="selection-hint">âš¡ ç”Ÿäº§ç¯å¢ƒé¦–é€‰æ–¹æ¡ˆ</span>
            </div>
        </div>
    </div>
    
    <!-- ç®—æ³•å¯¹æ¯”æ€»ç»“ -->
    <div class="algorithm-comparison-summary">
        <h3><i class="fas fa-chart-bar"></i> ç®—æ³•é€‰æ‹©æŒ‡å—</h3>
        <div class="comparison-grid">
            <div class="comparison-item">
                <div class="comparison-icon academic">
                    <i class="fas fa-graduation-cap"></i>
                </div>
                <div class="comparison-content">
                    <h4>å­¦æœ¯ç ”ç©¶</h4>
                    <p>é€‰æ‹© <strong>Boneh-Franklin</strong>ï¼Œç†è®ºåŸºç¡€æ‰å®ï¼Œæ˜¯IBEé¢†åŸŸçš„ç»å…¸æ•™ææ–¹æ¡ˆ</p>
                </div>
            </div>
            <div class="comparison-item">
                <div class="comparison-icon security">
                    <i class="fas fa-shield-alt"></i>
                </div>
                <div class="comparison-content">
                    <h4>é«˜å®‰å…¨éœ€æ±‚</h4>
                    <p>é€‰æ‹© <strong>Boneh-Boyen</strong>ï¼Œæ ‡å‡†æ¨¡å‹å®‰å…¨ï¼Œå¯è¯æ˜å®‰å…¨æ€§æœ€å¼º</p>
                </div>
            </div>
            <div class="comparison-item">
                <div class="comparison-icon performance">
                    <i class="fas fa-rocket"></i>
                </div>
                <div class="comparison-content">
                    <h4>ç”Ÿäº§åº”ç”¨</h4>
                    <p>é€‰æ‹© <strong>Sakai-Kasahara</strong>ï¼Œæ€§èƒ½ä¼˜åŒ–æè‡´ï¼Œé€‚åˆå¤§è§„æ¨¡éƒ¨ç½²</p>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- ç³»ç»Ÿè®¾ç½® -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-cog"></i> ç³»ç»Ÿè®¾ç½®</h2>
    <p style="color: #666; margin-bottom: 20px;">
        é¦–å…ˆéœ€è¦åˆå§‹åŒ–IBEç³»ç»Ÿï¼Œç”Ÿæˆç³»ç»Ÿå‚æ•°å’Œä¸»å¯†é’¥ã€‚
    </p>
    <button class="btn btn-primary" onclick="setupIBE()" id="setupBtn">
        <i class="fas fa-play"></i> åˆå§‹åŒ–IBEç³»ç»Ÿ
    </button>
    <div id="setupResult" style="display: none; margin-top: 20px;">
        <div class="alert alert-success">IBEç³»ç»Ÿåˆå§‹åŒ–æˆåŠŸï¼</div>
    </div>
</div>

<!-- å¯†é’¥æå– -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-key"></i> å¯†é’¥æå–</h2>
    <div class="form-group">
        <label class="form-label">ç”¨æˆ·èº«ä»½:</label>
        <input type="text" class="form-control" id="identityInput" 
               placeholder="ä¾‹å¦‚: alice@example.com" value="alice@example.com">
    </div>
    <button class="btn btn-primary" onclick="extractKey()" id="extractBtn" disabled>
        <i class="fas fa-download"></i> æå–ç§é’¥
    </button>
    <div id="extractResult" style="display: none; margin-top: 20px;">
        <div class="output-area" id="privateKeyOutput">ç§é’¥å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
    </div>
</div>

<!-- åŠ å¯†è§£å¯† -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-shield-alt"></i> åŠ å¯†è§£å¯†</h2>
    <div class="tool-grid">
        <div>
            <h4>åŠ å¯†</h4>
            <div class="form-group">
                <label class="form-label">æ¥æ”¶æ–¹èº«ä»½:</label>
                <input type="text" class="form-control" id="encryptIdentity" 
                       value="alice@example.com">
            </div>
            <div class="form-group">
                <label class="form-label">æ¶ˆæ¯:</label>
                <textarea class="form-control" id="messageInput" rows="3">Hello Alice!</textarea>
            </div>
            <button class="btn btn-primary" onclick="encryptMessage()" id="encryptBtn" disabled>
                <i class="fas fa-lock"></i> åŠ å¯†
            </button>
            <div class="output-area" id="ciphertextOutput" style="margin-top: 15px;">å¯†æ–‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
        <div>
            <h4>è§£å¯†</h4>
            <div class="form-group">
                <label class="form-label">å¯†æ–‡:</label>
                <textarea class="form-control" id="ciphertextInput" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label class="form-label">ç§é’¥:</label>
                <textarea class="form-control" id="privateKeyInput" rows="3"></textarea>
            </div>
            <button class="btn btn-primary" onclick="decryptMessage()" id="decryptBtn" disabled>
                <i class="fas fa-unlock"></i> è§£å¯†
            </button>
            <div class="output-area" id="plaintextOutput" style="margin-top: 15px;">æ˜æ–‡å°†æ˜¾ç¤ºåœ¨è¿™é‡Œ...</div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_scripts %}
<script>
    let currentAlgorithm = 'boneh_franklin';
    let systemReady = false;

    // å¢å¼ºçš„ç®—æ³•é€‰æ‹©å™¨é€»è¾‘
    document.querySelectorAll('.algorithm-card-enhanced').forEach(card => {
        card.addEventListener('click', function() {
            document.querySelectorAll('.algorithm-card-enhanced').forEach(c => c.classList.remove('active'));
            this.classList.add('active');
            
            currentAlgorithm = this.dataset.algorithm;
            systemReady = false; // åˆ‡æ¢ç®—æ³•åéœ€è¦é‡æ–°åˆå§‹åŒ–

            // é‡ç½®ç³»ç»ŸçŠ¶æ€
            document.getElementById('setupResult').style.display = 'none';
            document.getElementById('extractResult').style.display = 'none';

            showAlert(`å·²åˆ‡æ¢åˆ° ${this.querySelector('.algorithm-name').textContent} ç®—æ³•`, 'info');
        });
    });

    // åˆå§‹åŒ–IBEç³»ç»Ÿ
    async function setupIBE() {
        const btn = document.getElementById('setupBtn');
        try {
            btn.innerHTML = '<span class="loading"></span> è®¾ç½®ä¸­...';
            btn.disabled = true;
            
            const response = await fetch('/api/ibe/setup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ scheme: currentAlgorithm })
            });
            
            const data = await response.json();
            if (data.status === 'success') {
                systemReady = true;
                document.getElementById('setupResult').style.display = 'block';
                document.getElementById('extractBtn').disabled = false;
                document.getElementById('encryptBtn').disabled = false;
                document.getElementById('decryptBtn').disabled = false;
                showAlert('IBEç³»ç»Ÿè®¾ç½®æˆåŠŸï¼', 'success');
            } else {
                throw new Error(data.error);
            }
        } catch (error) {
            showAlert('è®¾ç½®å¤±è´¥: ' + error.message, 'error');
        } finally {
            btn.innerHTML = '<i class="fas fa-play"></i> åˆå§‹åŒ–IBEç³»ç»Ÿ';
            btn.disabled = false;
        }
    }

    // å¯†é’¥æå–
    async function extractKey() {
        const identity = document.getElementById('identityInput').value.trim();
        if (!identity) {
            showAlert('è¯·è¾“å…¥èº«ä»½ä¿¡æ¯', 'warning');
            return;
        }
        
        try {
            const response = await fetch('/api/ibe/extract', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ scheme: currentAlgorithm, identity: identity })
            });
            
            const data = await response.json();
            if (data.status === 'success') {
                // æ˜¾ç¤ºæå–ç»“æœ
                document.getElementById('extractResult').style.display = 'block';
                
                // æ­£ç¡®å¤„ç†ç§é’¥æ˜¾ç¤º - å¦‚æœæ˜¯å¯¹è±¡åˆ™è½¬ä¸ºJSONå­—ç¬¦ä¸²
                const privateKeyDisplay = typeof data.private_key === 'object' ? 
                    JSON.stringify(data.private_key, null, 2) : data.private_key;
                document.getElementById('privateKeyOutput').textContent = privateKeyDisplay;
                
                // è‡ªåŠ¨å¡«å……åˆ°è§£å¯†åŒºåŸŸ - ä¹Ÿä½¿ç”¨ç›¸åŒçš„æ ¼å¼
                document.getElementById('privateKeyInput').value = privateKeyDisplay;
                document.getElementById('encryptIdentity').value = identity;
                showAlert('å¯†é’¥æå–æˆåŠŸï¼', 'success');
            } else {
                throw new Error(data.error);
            }
        } catch (error) {
            showAlert('æå–å¤±è´¥: ' + error.message, 'error');
        }
    }

    // åŠ å¯†
    async function encryptMessage() {
        const identity = document.getElementById('encryptIdentity').value.trim();
        const message = document.getElementById('messageInput').value.trim();
        
        if (!identity || !message) {
            showAlert('è¯·è¾“å…¥èº«ä»½å’Œæ¶ˆæ¯', 'warning');
            return;
        }
        
        try {
            const response = await fetch('/api/ibe/encrypt', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ scheme: currentAlgorithm, identity: identity, message: message })
            });
            
            const data = await response.json();
            if (data.status === 'success') {
                const ciphertext = typeof data.ciphertext === 'object' ? JSON.stringify(data.ciphertext, null, 2) : data.ciphertext;
                document.getElementById('ciphertextOutput').textContent = ciphertext;
                document.getElementById('ciphertextInput').value = ciphertext;
                showAlert('åŠ å¯†æˆåŠŸï¼', 'success');
            } else {
                throw new Error(data.error);
            }
        } catch (error) {
            showAlert('åŠ å¯†å¤±è´¥: ' + error.message, 'error');
        }
    }

    // è§£å¯†
    async function decryptMessage() {
        const ciphertext = document.getElementById('ciphertextInput').value.trim();
        const privateKey = document.getElementById('privateKeyInput').value.trim();
        
        if (!ciphertext || !privateKey) {
            showAlert('è¯·è¾“å…¥å¯†æ–‡å’Œç§é’¥', 'warning');
            return;
        }
        
        try {
            let privateKeyData;
            try {
                privateKeyData = JSON.parse(privateKey);
            } catch {
                privateKeyData = privateKey;
            }
            
            let ciphertextData;
            try {
                ciphertextData = JSON.parse(ciphertext);
            } catch {
                ciphertextData = ciphertext;
            }
            
            const response = await fetch('/api/ibe/decrypt', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ scheme: currentAlgorithm, private_key: privateKeyData, ciphertext: ciphertextData })
            });
            
            const data = await response.json();
            if (data.status === 'success') {
                document.getElementById('plaintextOutput').textContent = data.plaintext;
                showAlert('è§£å¯†æˆåŠŸï¼', 'success');
            } else {
                throw new Error(data.error);
            }
        } catch (error) {
            showAlert('è§£å¯†å¤±è´¥: ' + error.message, 'error');
        }
    }
</script>
{% endblock %} 