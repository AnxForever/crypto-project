{% extends "base.html" %}

{% block title %}IBEæ€§èƒ½åˆ†æ - å¯†ç å­¦å·¥å…·å¹³å°{% endblock %}

{% block content %}
<div class="page-header">
    <h1 class="page-title"><i class="fas fa-user-shield"></i> IBEæ€§èƒ½åˆ†æ</h1>
    <p class="page-description">
        æ·±å…¥åˆ†æåŸºäºèº«ä»½åŠ å¯†ï¼ˆIBEï¼‰ç®—æ³•çš„æ€§èƒ½è¡¨ç°ï¼ŒåŒ…æ‹¬ç³»ç»Ÿè®¾ç½®ã€å¯†é’¥æå–ã€åŠ å¯†è§£å¯†ç­‰å„ä¸ªç¯èŠ‚çš„æ€§èƒ½æŒ‡æ ‡ã€‚
    </p>
</div>

<!-- IBEæ€§èƒ½æ¦‚è§ˆ -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-tachometer-alt"></i> IBEæ€§èƒ½æ¦‚è§ˆ</h2>
    <div class="stats-grid">
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-cog"></i></div>
            <div class="stat-info">
                <div class="stat-value">42ms</div>
                <div class="stat-label">å¹³å‡ç³»ç»Ÿè®¾ç½®æ—¶é—´</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-key"></i></div>
            <div class="stat-info">
                <div class="stat-value">21ms</div>
                <div class="stat-label">å¹³å‡å¯†é’¥æå–æ—¶é—´</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-lock"></i></div>
            <div class="stat-info">
                <div class="stat-value">17ms</div>
                <div class="stat-label">å¹³å‡åŠ å¯†æ—¶é—´</div>
            </div>
        </div>
        <div class="stat-card">
            <div class="stat-icon"><i class="fas fa-unlock"></i></div>
            <div class="stat-info">
                <div class="stat-value">24ms</div>
                <div class="stat-label">å¹³å‡è§£å¯†æ—¶é—´</div>
            </div>
        </div>
    </div>
</div>

<!-- IBEä¸“é¡¹åˆ†æå›¾è¡¨å±•ç¤º -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-chart-area"></i> IBEä¸“é¡¹æ€§èƒ½åˆ†æå›¾è¡¨</h2>
    <p class="card-description">åŸºäºçœŸå®ç®—æ³•åº“æµ‹è¯•æ•°æ®ç”Ÿæˆçš„é«˜è´¨é‡æ€§èƒ½åˆ†æå›¾è¡¨ï¼Œä¸“æ³¨IBEç®—æ³•å†…éƒ¨å¯¹æ¯”ã€‚</p>
    
    <div class="specialized-charts">
        <!-- IBEæ€§èƒ½å…¨æ™¯å›¾ -->
        <div class="chart-section">
            <div class="chart-header">
                <h3><i class="fas fa-binoculars"></i> IBEæ€§èƒ½å…¨æ™¯åˆ†æ</h3>
                <p>ç³»ç»Ÿè®¾ç½®ã€å¯†é’¥æå–ã€åŠ å¯†è§£å¯†å…¨æµç¨‹æ€§èƒ½å¯¹æ¯”</p>
            </div>
            <div class="chart-image-container">
                <img src="{{ url_for('static', filename='images/ibe_only_performance_overview.png') }}" 
                     alt="IBEæ€§èƒ½å…¨æ™¯åˆ†æ" class="analysis-chart" 
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="chart-placeholder" style="display: none;">
                    <i class="fas fa-image"></i>
                    <p>å›¾è¡¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨ååˆ·æ–°é¡µé¢</p>
                </div>
            </div>
        </div>
        
        <!-- IBEæ•ˆç‡åˆ†æå›¾ -->
        <div class="chart-section">
            <div class="chart-header">
                <h3><i class="fas fa-tachometer-alt"></i> IBEæ•ˆç‡æ·±åº¦åˆ†æ</h3>
                <p>å¯†é’¥æå–æ•ˆç‡ã€åŠ å¯†ååé‡åŠç»¼åˆæ€§èƒ½é›·è¾¾å›¾</p>
            </div>
            <div class="chart-image-container">
                <img src="{{ url_for('static', filename='images/ibe_only_efficiency_analysis.png') }}" 
                     alt="IBEæ•ˆç‡åˆ†æ" class="analysis-chart"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="chart-placeholder" style="display: none;">
                    <i class="fas fa-image"></i>
                    <p>å›¾è¡¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨ååˆ·æ–°é¡µé¢</p>
                </div>
            </div>
        </div>
        
        <!-- IBEæ¶ˆæ¯é€‚åº”æ€§åˆ†æ -->
        <div class="chart-section">
            <div class="chart-header">
                <h3><i class="fas fa-expand-arrows-alt"></i> æ¶ˆæ¯è§„æ¨¡é€‚åº”æ€§</h3>
                <p>ä¸åŒæ¶ˆæ¯ç±»å‹ä¸‹çš„æ€§èƒ½å˜åŒ–è¶‹åŠ¿åˆ†æ</p>
            </div>
            <div class="chart-image-container">
                <img src="{{ url_for('static', filename='images/ibe_only_message_scalability.png') }}" 
                     alt="IBEæ¶ˆæ¯é€‚åº”æ€§åˆ†æ" class="analysis-chart"
                     onerror="this.style.display='none'; this.nextElementSibling.style.display='block';">
                <div class="chart-placeholder" style="display: none;">
                    <i class="fas fa-image"></i>
                    <p>å›¾è¡¨ç”Ÿæˆä¸­ï¼Œè¯·ç¨ååˆ·æ–°é¡µé¢</p>
                </div>
            </div>
        </div>
    </div>
    
    <div class="chart-features">
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>åŸºäºçœŸå®IBEç®—æ³•åº“è°ƒç”¨çš„æ€§èƒ½æ•°æ®</span>
        </div>
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>16:10é»„é‡‘æ¯”ä¾‹ï¼Œé€‚é…ç°ä»£æ˜¾ç¤ºå™¨</span>
        </div>
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>ç»Ÿä¸€é…è‰²æ–¹æ¡ˆï¼Œä¾¿äºç®—æ³•è¯†åˆ«</span>
        </div>
        <div class="feature-item">
            <i class="fas fa-check-circle"></i>
            <span>ä¸“æ³¨IBEç®—æ³•å†…éƒ¨æ€§èƒ½å¯¹æ¯”</span>
        </div>
    </div>
</div>

<!-- å®æ—¶æ€§èƒ½æµ‹è¯• -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-stopwatch"></i> IBEæ€§èƒ½æµ‹è¯•</h2>
    <div class="form-group">
        <label class="form-label">æµ‹è¯•èº«ä»½æ ‡è¯†:</label>
        <input type="text" class="form-control" id="testIdentity" value="test@example.com" placeholder="ä¾‹å¦‚: alice@company.com">
    </div>
    <div class="form-group">
        <label class="form-label">æµ‹è¯•æ¶ˆæ¯:</label>
        <textarea class="form-control" id="testMessage" rows="3">è¿™æ˜¯ç”¨äºIBEæ€§èƒ½æµ‹è¯•çš„ç¤ºä¾‹æ¶ˆæ¯ï¼Œç”¨æ¥è¯„ä¼°ä¸åŒIBEç®—æ³•çš„å„é¡¹æ€§èƒ½æŒ‡æ ‡ã€‚</textarea>
    </div>
    
    <button class="btn btn-primary" onclick="runIBETests()" id="testBtn">
        <i class="fas fa-play"></i> å¼€å§‹IBEæ€§èƒ½æµ‹è¯•
    </button>
    
    <div id="testProgress" style="display: none; margin-top: 20px;">
        <div style="background: #f8f9fa; border-radius: 10px; padding: 20px;">
            <div id="currentTest" style="color: #666; font-size: 14px;">å‡†å¤‡æµ‹è¯•...</div>
            <div style="background: #e0e0e0; border-radius: 5px; overflow: hidden; height: 8px; margin-top: 10px;">
                <div id="progressBar" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); height: 100%; width: 0%; transition: width 0.3s ease;"></div>
            </div>
        </div>
    </div>
</div>

<!-- IBEæµ‹è¯•ç»“æœ -->
<div class="content-card" id="resultsSection" style="display: none;">
    <h2 class="card-title"><i class="fas fa-chart-line"></i> IBEæµ‹è¯•ç»“æœ</h2>
    
    <div class="ibe-results-grid">
        <div class="ibe-result-card" id="bfCard">
            <h4><i class="fas fa-shield-alt"></i> Boneh-Franklin IBE</h4>
            <div class="metrics">
                <div class="metric">
                    <span class="metric-label">ç³»ç»Ÿè®¾ç½®:</span>
                    <span class="metric-value" id="bfSetup">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">å¯†é’¥æå–:</span>
                    <span class="metric-value" id="bfExtract">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">åŠ å¯†æ—¶é—´:</span>
                    <span class="metric-value" id="bfEncrypt">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">è§£å¯†æ—¶é—´:</span>
                    <span class="metric-value" id="bfDecrypt">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æ€»è€—æ—¶:</span>
                    <span class="metric-value total" id="bfTotal">-</span>
                </div>
            </div>
        </div>
        
        <div class="ibe-result-card" id="bbCard">
            <h4><i class="fas fa-shield-alt"></i> Boneh-Boyen IBE</h4>
            <div class="metrics">
                <div class="metric">
                    <span class="metric-label">ç³»ç»Ÿè®¾ç½®:</span>
                    <span class="metric-value" id="bbSetup">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">å¯†é’¥æå–:</span>
                    <span class="metric-value" id="bbExtract">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">åŠ å¯†æ—¶é—´:</span>
                    <span class="metric-value" id="bbEncrypt">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">è§£å¯†æ—¶é—´:</span>
                    <span class="metric-value" id="bbDecrypt">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æ€»è€—æ—¶:</span>
                    <span class="metric-value total" id="bbTotal">-</span>
                </div>
            </div>
        </div>
        
        <div class="ibe-result-card" id="skCard">
            <h4><i class="fas fa-shield-alt"></i> Sakai-Kasahara IBE</h4>
            <div class="metrics">
                <div class="metric">
                    <span class="metric-label">ç³»ç»Ÿè®¾ç½®:</span>
                    <span class="metric-value" id="skSetup">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">å¯†é’¥æå–:</span>
                    <span class="metric-value" id="skExtract">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">åŠ å¯†æ—¶é—´:</span>
                    <span class="metric-value" id="skEncrypt">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">è§£å¯†æ—¶é—´:</span>
                    <span class="metric-value" id="skDecrypt">-</span>
                </div>
                <div class="metric">
                    <span class="metric-label">æ€»è€—æ—¶:</span>
                    <span class="metric-value total" id="skTotal">-</span>
                </div>
            </div>
        </div>
    </div>
    
    <div id="winner" style="margin-top: 30px; text-align: center;">
        <div class="alert alert-success" id="winnerAlert" style="display: none;">
            <h4>ğŸ† IBEæ€§èƒ½æœ€ä¼˜</h4>
            <p id="winnerText"></p>
        </div>
    </div>
</div>

<!-- IBEç®—æ³•è¯¦ç»†åˆ†æ -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-microscope"></i> IBEç®—æ³•è¯¦ç»†åˆ†æ</h2>
    
    <div class="analysis-grid">
        <div class="analysis-card">
            <h4><i class="fas fa-shield-alt"></i> Boneh-Franklin IBE</h4>
            <div class="analysis-content">
                <p><strong>æ ¸å¿ƒç‰¹ç‚¹:</strong> ç¬¬ä¸€ä¸ªå®ç”¨çš„IBEæ–¹æ¡ˆï¼ŒåŸºäºåŒçº¿æ€§å¯¹</p>
                <p><strong>å®‰å…¨æ¨¡å‹:</strong> éšæœºé¢„è¨€æœºæ¨¡å‹ä¸‹å®‰å…¨</p>
                <p><strong>æ€§èƒ½ç‰¹æ€§:</strong> åŠ å¯†æ•ˆç‡è¾ƒé«˜ï¼Œè§£å¯†éœ€è¦é…å¯¹è¿ç®—</p>
                <p><strong>é€‚ç”¨åœºæ™¯:</strong> ä¸€èˆ¬æ€§IBEåº”ç”¨ï¼Œå­¦æœ¯ç ”ç©¶åŸºç¡€</p>
                <div class="tech-specs">
                    <span class="spec-tag">åŒçº¿æ€§å¯¹</span>
                    <span class="spec-tag">AESåŠ å¯†</span>
                    <span class="spec-tag">PBKDF2</span>
                </div>
            </div>
        </div>
        
        <div class="analysis-card">
            <h4><i class="fas fa-shield-alt"></i> Boneh-Boyen IBE</h4>
            <div class="analysis-content">
                <p><strong>æ ¸å¿ƒç‰¹ç‚¹:</strong> æ ‡å‡†æ¨¡å‹ä¸‹å®‰å…¨çš„IBEæ–¹æ¡ˆ</p>
                <p><strong>å®‰å…¨æ¨¡å‹:</strong> ä¸ä¾èµ–éšæœºé¢„è¨€æœºå‡è®¾</p>
                <p><strong>æ€§èƒ½ç‰¹æ€§:</strong> å¢å¼ºå®‰å…¨æ€§ï¼Œç•¥å¢è®¡ç®—å¼€é”€</p>
                <p><strong>é€‚ç”¨åœºæ™¯:</strong> é«˜å®‰å…¨è¦æ±‚çš„ä¼ä¸šç¯å¢ƒ</p>
                <div class="tech-specs">
                    <span class="spec-tag">æ ‡å‡†æ¨¡å‹</span>
                    <span class="spec-tag">AES-GCM</span>
                    <span class="spec-tag">HMAC</span>
                </div>
            </div>
        </div>
        
        <div class="analysis-card">
            <h4><i class="fas fa-shield-alt"></i> Sakai-Kasahara IBE</h4>
            <div class="analysis-content">
                <p><strong>æ ¸å¿ƒç‰¹ç‚¹:</strong> é«˜æ•ˆçš„IBEå®ç°ï¼Œç´§å‡‘å¯†æ–‡</p>
                <p><strong>å®‰å…¨æ¨¡å‹:</strong> åŸºäºæ”¹è¿›çš„æ•°å­¦å‡è®¾</p>
                <p><strong>æ€§èƒ½ç‰¹æ€§:</strong> æµå¯†ç ä¼˜åŒ–ï¼Œå¿«é€Ÿè¿ç®—</p>
                <p><strong>é€‚ç”¨åœºæ™¯:</strong> æ€§èƒ½æ•æ„Ÿçš„å®æ—¶åº”ç”¨</p>
                <div class="tech-specs">
                    <span class="spec-tag">ChaCha20</span>
                    <span class="spec-tag">é€†å…ƒè¿ç®—</span>
                    <span class="spec-tag">æµå¯†ç </span>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- IBE vs PKEå¯¹æ¯” -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-balance-scale"></i> IBE vs PKE å¯¹æ¯”åˆ†æ</h2>
    
    <div class="comparison-table">
        <table class="performance-table">
            <thead>
                <tr>
                    <th>ç‰¹æ€§</th>
                    <th>IBE (åŸºäºèº«ä»½åŠ å¯†)</th>
                    <th>PKE (å…¬é’¥åŠ å¯†)</th>
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td>å¯†é’¥ç®¡ç†</td>
                    <td>âœ… èº«ä»½å³å…¬é’¥ï¼Œç®€åŒ–ç®¡ç†</td>
                    <td>âŒ éœ€è¦å¤æ‚çš„è¯ä¹¦åŸºç¡€è®¾æ–½</td>
                </tr>
                <tr>
                    <td>åˆå§‹åŒ–å¼€é”€</td>
                    <td>âŒ éœ€è¦å¯ä¿¡ç¬¬ä¸‰æ–¹PKG</td>
                    <td>âœ… æ— éœ€ä¸­å¿ƒåŒ–åˆå§‹åŒ–</td>
                </tr>
                <tr>
                    <td>åŠ å¯†é€Ÿåº¦</td>
                    <td>âš¡ ä¸­ç­‰ (~17ms)</td>
                    <td>âš¡ å¿«é€Ÿ (~10ms)</td>
                </tr>
                <tr>
                    <td>è§£å¯†é€Ÿåº¦</td>
                    <td>âš¡ ä¸­ç­‰ (~24ms)</td>
                    <td>âš¡ å¿«é€Ÿ (~13ms)</td>
                </tr>
                <tr>
                    <td>é€‚ç”¨åœºæ™¯</td>
                    <td>ğŸ¢ ä¼ä¸šå†…éƒ¨ã€åŒ»ç–—ã€é‚®ä»¶</td>
                    <td>ğŸŒ äº’è”ç½‘ã€ç”µå­å•†åŠ¡ã€é€šç”¨</td>
                </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- æ€§èƒ½ä¼˜åŒ–å»ºè®® -->
<div class="content-card">
    <h2 class="card-title"><i class="fas fa-rocket"></i> IBEæ€§èƒ½ä¼˜åŒ–å»ºè®®</h2>
    
    <div class="features-grid">
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-microchip"></i>
            </div>
            <div class="feature-title">ç¡¬ä»¶åŠ é€Ÿ</div>
            <div class="feature-description">
                åˆ©ç”¨AES-NIæŒ‡ä»¤é›†å’Œæ¤­åœ†æ›²çº¿ç¡¬ä»¶åŠ é€Ÿï¼Œæå‡å¯†ç å­¦è¿ç®—æ€§èƒ½ã€‚
            </div>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-memory"></i>
            </div>
            <div class="feature-title">ç¼“å­˜ä¼˜åŒ–</div>
            <div class="feature-description">
                ç¼“å­˜é¢‘ç¹ä½¿ç”¨çš„ç³»ç»Ÿå‚æ•°å’Œä¸­é—´è®¡ç®—ç»“æœï¼Œå‡å°‘é‡å¤è¿ç®—ã€‚
            </div>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-code-branch"></i>
            </div>
            <div class="feature-title">å¹¶è¡Œå¤„ç†</div>
            <div class="feature-description">
                åˆ©ç”¨å¤šæ ¸å¤„ç†å™¨å¹¶è¡Œæ‰§è¡Œå¯†é’¥æå–å’ŒåŠ å¯†æ“ä½œï¼Œæå‡ååé‡ã€‚
            </div>
        </div>
        
        <div class="feature-card">
            <div class="feature-icon">
                <i class="fas fa-database"></i>
            </div>
            <div class="feature-title">é¢„è®¡ç®—ä¼˜åŒ–</div>
            <div class="feature-description">
                é¢„è®¡ç®—å¸¸ç”¨èº«ä»½çš„å¯†é’¥å’Œå‚æ•°ï¼Œåœ¨å®é™…ä½¿ç”¨æ—¶å¿«é€Ÿå“åº”ã€‚
            </div>
        </div>
    </div>
</div>

{% endblock %}

{% block extra_scripts %}
<script>
    // è¿è¡ŒIBEæ€§èƒ½æµ‹è¯•
    async function runIBETests() {
        const identity = document.getElementById('testIdentity').value.trim();
        const message = document.getElementById('testMessage').value.trim();
        
        if (!identity || !message) {
            showAlert('è¯·è¾“å…¥æµ‹è¯•èº«ä»½å’Œæ¶ˆæ¯', 'warning');
            return;
        }
        
        const testBtn = document.getElementById('testBtn');
        testBtn.disabled = true;
        testBtn.innerHTML = '<span class="loading"></span> æµ‹è¯•ä¸­...';
        document.getElementById('testProgress').style.display = 'block';
        
        const schemes = ['boneh_franklin', 'boneh_boyen', 'sakai_kasahara'];
        const results = {};
        let bestTime = Infinity;
        let bestScheme = '';
        
        for (let i = 0; i < schemes.length; i++) {
            const scheme = schemes[i];
            
            // æ›´æ–°è¿›åº¦
            document.getElementById('currentTest').textContent = `æ­£åœ¨æµ‹è¯• ${getSchemeDisplayName(scheme)}...`;
            document.getElementById('progressBar').style.width = `${((i + 1) / schemes.length) * 100}%`;
            
            try {
                const result = await testIBEScheme(scheme, identity, message);
                results[scheme] = result;
                
                // æ›´æ–°ç»“æœæ˜¾ç¤º
                updateSchemeResults(scheme, result);
                
                if (result.total < bestTime) {
                    bestTime = result.total;
                    bestScheme = scheme;
                }
                
                await new Promise(resolve => setTimeout(resolve, 100));
            } catch (error) {
                console.error(`æµ‹è¯• ${scheme} å¤±è´¥:`, error);
                showAlert(`æµ‹è¯• ${getSchemeDisplayName(scheme)} å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // æ˜¾ç¤ºæœ€ä¼˜ç»“æœ
        if (bestScheme) {
            document.getElementById('winnerAlert').style.display = 'block';
            document.getElementById('winnerText').textContent = 
                `${getSchemeDisplayName(bestScheme)} è¡¨ç°æœ€ä½³ï¼Œæ€»è€—æ—¶ ${bestTime.toFixed(1)}ms`;
            
            // é«˜äº®æœ€ä¼˜æ–¹æ¡ˆ
            document.getElementById(`${getSchemePrefix(bestScheme)}Card`).style.border = '2px solid #4caf50';
        }
        
        document.getElementById('resultsSection').style.display = 'block';
        testBtn.disabled = false;
        testBtn.innerHTML = '<i class="fas fa-play"></i> é‡æ–°æµ‹è¯•';
        document.getElementById('testProgress').style.display = 'none';
    }
    
    // æµ‹è¯•å•ä¸ªIBEæ–¹æ¡ˆ
    async function testIBEScheme(scheme, identity, message) {
        const times = {};
        
        // 1. ç³»ç»Ÿè®¾ç½®
        const setupStart = performance.now();
        const setupResponse = await fetch('/api/ibe/setup', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ scheme: scheme })
        });
        const setupData = await setupResponse.json();
        times.setup = performance.now() - setupStart;
        
        if (setupData.status !== 'success') {
            throw new Error('ç³»ç»Ÿè®¾ç½®å¤±è´¥');
        }
        
        // 2. å¯†é’¥æå–
        const extractStart = performance.now();
        const extractResponse = await fetch('/api/ibe/extract', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ scheme: scheme, identity: identity })
        });
        const extractData = await extractResponse.json();
        times.extract = performance.now() - extractStart;
        
        if (extractData.status !== 'success') {
            throw new Error('å¯†é’¥æå–å¤±è´¥');
        }
        
        // 3. åŠ å¯†
        const encryptStart = performance.now();
        const encryptResponse = await fetch('/api/ibe/encrypt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ scheme: scheme, identity: identity, message: message })
        });
        const encryptData = await encryptResponse.json();
        times.encrypt = performance.now() - encryptStart;
        
        if (encryptData.status !== 'success') {
            throw new Error('åŠ å¯†å¤±è´¥');
        }
        
        // 4. è§£å¯†
        const decryptStart = performance.now();
        const decryptResponse = await fetch('/api/ibe/decrypt', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                scheme: scheme,
                private_key: extractData.private_key,
                ciphertext: encryptData.ciphertext
            })
        });
        const decryptData = await decryptResponse.json();
        times.decrypt = performance.now() - decryptStart;
        
        if (decryptData.status !== 'success') {
            throw new Error('è§£å¯†å¤±è´¥');
        }
        
        times.total = times.setup + times.extract + times.encrypt + times.decrypt;
        return times;
    }
    
    // æ›´æ–°æ–¹æ¡ˆç»“æœæ˜¾ç¤º
    function updateSchemeResults(scheme, result) {
        const prefix = getSchemePrefix(scheme);
        document.getElementById(`${prefix}Setup`).textContent = result.setup.toFixed(1) + 'ms';
        document.getElementById(`${prefix}Extract`).textContent = result.extract.toFixed(1) + 'ms';
        document.getElementById(`${prefix}Encrypt`).textContent = result.encrypt.toFixed(1) + 'ms';
        document.getElementById(`${prefix}Decrypt`).textContent = result.decrypt.toFixed(1) + 'ms';
        document.getElementById(`${prefix}Total`).textContent = result.total.toFixed(1) + 'ms';
    }
    
    // è·å–æ–¹æ¡ˆæ˜¾ç¤ºåç§°
    function getSchemeDisplayName(scheme) {
        const names = {
            'boneh_franklin': 'Boneh-Franklin IBE',
            'boneh_boyen': 'Boneh-Boyen IBE',
            'sakai_kasahara': 'Sakai-Kasahara IBE'
        };
        return names[scheme] || scheme;
    }
    
    // è·å–æ–¹æ¡ˆå‰ç¼€
    function getSchemePrefix(scheme) {
        const prefixes = {
            'boneh_franklin': 'bf',
            'boneh_boyen': 'bb',
            'sakai_kasahara': 'sk'
        };
        return prefixes[scheme] || scheme;
    }
</script>

<style>
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.stat-card {
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(20px);
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    border: 1px solid rgba(255, 255, 255, 0.18);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 15px;
}

.stat-icon {
    font-size: 2rem;
    color: #667eea;
}

.stat-value {
    font-size: 1.8rem;
    font-weight: bold;
    color: #333;
}

.stat-label {
    color: #666;
    font-size: 0.9rem;
}

.ibe-results-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
    margin-bottom: 30px;
}

.ibe-result-card {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 20px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    border: 1px solid rgba(255, 255, 255, 0.18);
}

.ibe-result-card h4 {
    color: #333;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.metrics {
    display: flex;
    flex-direction: column;
    gap: 8px;
}

.metric {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 8px 0;
    border-bottom: 1px solid #eee;
}

.metric:last-child {
    border-bottom: none;
    margin-top: 10px;
    padding-top: 15px;
    border-top: 2px solid #667eea;
}

.metric-label {
    color: #666;
    font-size: 0.9rem;
}

.metric-value {
    font-weight: bold;
    color: #333;
}

.metric-value.total {
    color: #667eea;
    font-size: 1.1rem;
}

.analysis-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: 20px;
}

.analysis-card {
    background: #f8f9fa;
    border-radius: 15px;
    padding: 20px;
    border-left: 4px solid #667eea;
}

.analysis-card h4 {
    color: #333;
    margin-bottom: 15px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.analysis-content p {
    margin-bottom: 10px;
    color: #555;
    line-height: 1.6;
}

.tech-specs {
    margin-top: 15px;
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
}

.spec-tag {
    background: #667eea;
    color: white;
    padding: 4px 12px;
    border-radius: 20px;
    font-size: 0.8rem;
    font-weight: 500;
}

.comparison-table {
    overflow-x: auto;
}

.performance-table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    border-radius: 10px;
    overflow: hidden;
    box-shadow: 0 4px 16px rgba(0,0,0,0.1);
}

.performance-table th,
.performance-table td {
    padding: 15px;
    text-align: left;
    border-bottom: 1px solid #eee;
}

.performance-table th {
    background: #667eea;
    color: white;
    font-weight: 600;
}

.performance-table tr:hover {
    background: #f8f9fa;
}

.features-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 20px;
}

.feature-card {
    background: rgba(255, 255, 255, 0.9);
    border-radius: 15px;
    padding: 20px;
    text-align: center;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.37);
    border: 1px solid rgba(255, 255, 255, 0.18);
    transition: transform 0.3s ease;
}

.feature-card:hover {
    transform: translateY(-5px);
}

.feature-icon {
    font-size: 2.5rem;
    color: #667eea;
    margin-bottom: 15px;
}

.feature-title {
    font-size: 1.2rem;
    font-weight: bold;
    color: #333;
    margin-bottom: 10px;
}

.feature-description {
    color: #666;
    line-height: 1.6;
}

/* IBEä¸“é¡¹åˆ†æå›¾è¡¨æ ·å¼ */
.specialized-charts {
    display: grid;
    grid-template-columns: 1fr;
    gap: 30px;
    margin-bottom: 30px;
}

.chart-section {
    background: rgba(255, 255, 255, 0.95);
    border-radius: 15px;
    padding: 25px;
    box-shadow: 0 8px 32px rgba(31, 38, 135, 0.15);
    border: 1px solid rgba(255, 255, 255, 0.3);
    transition: transform 0.3s ease, box-shadow 0.3s ease;
}

.chart-section:hover {
    transform: translateY(-2px);
    box-shadow: 0 12px 40px rgba(31, 38, 135, 0.25);
}

.chart-header {
    margin-bottom: 20px;
    text-align: center;
}

.chart-header h3 {
    color: #333;
    margin-bottom: 8px;
    font-size: 1.4rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
}

.chart-header p {
    color: #666;
    font-size: 0.95rem;
    margin: 0;
    line-height: 1.5;
}

.chart-image-container {
    position: relative;
    text-align: center;
    border-radius: 10px;
    overflow: hidden;
    background: #fafafa;
}

.analysis-chart {
    max-width: 100%;
    height: auto;
    border-radius: 10px;
    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
    transition: transform 0.3s ease;
}

.analysis-chart:hover {
    transform: scale(1.02);
}

.chart-placeholder {
    padding: 60px 20px;
    color: #999;
    font-size: 1.1rem;
    background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
}

.chart-placeholder i {
    font-size: 3rem;
    margin-bottom: 15px;
    display: block;
    opacity: 0.6;
}

.chart-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 15px;
    margin-top: 25px;
    padding: 20px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 10px;
    border-left: 4px solid #667eea;
}

.chart-features .feature-item {
    display: flex;
    align-items: center;
    gap: 10px;
    color: #555;
    font-size: 0.9rem;
}

.chart-features .feature-item i {
    color: #667eea;
    font-size: 1rem;
}

.card-description {
    color: #666;
    font-size: 0.95rem;
    margin-bottom: 25px;
    line-height: 1.6;
    text-align: center;
    padding: 15px;
    background: rgba(102, 126, 234, 0.05);
    border-radius: 10px;
    border-left: 4px solid #667eea;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .analysis-chart {
        border-radius: 8px;
    }
    
    .chart-section {
        padding: 20px;
    }
    
    .chart-header h3 {
        font-size: 1.2rem;
    }
    
    .chart-features {
        grid-template-columns: 1fr;
    }
}
</style>
{% endblock %} 